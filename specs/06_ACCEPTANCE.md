# specs/06_ACCEPTANCE.md (受入条件定義)

> バージョン: v0.2 (2025-09-18 JST)
> BDDシナリオに基づく受入条件定義

## 受入条件概要

`03_USECASES.md`で定義された各ユースケースについて、その振る舞いが正しいことを検証するための受け入れ基準を、ユーザー視点のシナリオ(Gherkin形式)で定義する。

### 検証方針
- **振る舞い駆動 (BDD)**: ユーザーが観測可能なシステムの振る舞いを基準とする。
- **実装非依存**: 「Firestore」や「API」といった内部実装の言葉を避け、UI上の振る舞いに焦点を当てる。
- **網羅性**: 正常系(Happy Path)だけでなく、代替フローや異常系もシナリオとして記述する。

---

## Family & Member管理

### ACC-FAM-001: 家族の新規作成 (UC-FAM-001)

**シナリオ:** 新規ユーザーが家族を作成する
- **Given** ユーザーは認証済みで、どの家族にも所属していない
- **When** ユーザーが家族作成画面で家族名「鈴木家」を入力し、「作成」ボタンを押す
- **Then** アプリケーションのメイン画面に遷移する
- **And** 画面に家族名「鈴木家」が表示されている

### ACC-MEM-001: メンバーの招待 (UC-MEM-001)

**シナリオ:** 保護者が子供を家族に招待する
- **Given** 保護者としてログインしている
- **When** メンバー追加画面で子供の名前「太郎」を入力し、「招待コードを生成」ボタンを押す
- **Then** 画面に8桁の招待コードが表示される
- **And** メンバー一覧画面に「太郎」が「招待中」の状態で表示される

### ACC-MEM-002: 家族への参加 (UC-MEM-002)

**シナリオ:** 子供が招待コードを使って家族に参加する
- **Given** 子供はまだどの家族にも所属していない
- **And** 有効な招待コードを持っている
- **When** アプリ起動時に招待コードを入力し、「参加」ボタンを押す
- **Then** アプリケーションのメイン画面に遷移する
- **And** 画面に所属する家族名が表示される

## Task管理

### ACC-TSK-001: タスクの作成 (UC-TSK-001)

**シナリオ:** 保護者が子供にタスクを割り当てる
- **Given** 保護者としてログインしている
- **When** タスク作成画面でタイトル「算数の宿題」と担当者「太郎」を選択し、「作成」ボタンを押す
- **Then** タスク一覧画面に「算数の宿題」という新しいタスクが表示される
- **And** そのタスクの担当者が「太郎」になっている

### ACC-TSK-002: タスクの進捗更新 (UC-TSK-002)

**シナリオ:** 子供が自分のタスクのステータスを変更する
- **Given** 子供「太郎」としてログインしている
- **And** 「算数の宿題」が「未着手(todo)」状態で表示されている
- **When** 「算数の宿題」のステータスを「進行中(doing)」に変更する
- **Then** 「算数の宿題」のステータスが「進行中」として表示される

### ACC-TSK-003: 状態の同期

**シナリオ:** あるデバイスでの変更が他のデバイスに反映される
- **Given** 保護者がデバイスAで、子供「太郎」がデバイスBで、それぞれ同じ家族にログインしている
- **When** 保護者がデバイスAで新しいタスク「読書」を作成する
- **Then** 数秒以内に、子供「太郎」のデバイスBのタスク一覧に「読書」タスクが表示される

## Evidence管理

### ACC-EVD-001: 証拠の投稿 (UC-EVD-001)

**シナリオ:** 子供がタスクの証拠として写真を投稿する
- **Given** 子供としてログインしている
- **When** 証拠投稿画面で写真を添付し、「投稿」ボタンを押す
- **Then** 証拠一覧画面に、投稿した写真のサムネイルが表示される
- **And** 保護者のデバイスからも、その証拠が閲覧できる

**シナリオ:** 証拠投稿時のファイルサイズ上限超過
- **Given** ユーザーがログインしている
- **And** 家族のストレージ使用量が上限に近い
- **When** 上限を超えるサイズのファイルをアップロードしようとする
- **Then** 「ストレージ容量が不足しています」というエラーメッセージが表示される
- **And** ファイルのアップロードは開始されない

## 認証と認可

### ACC-AUTH-001: アクセス権限制御

**シナリオ:** 子供は他の子供のデータを見ることができない
- **Given** 子供「太郎」としてログインしている
- **And** 家族には子供「花子」も所属している
- **When** 「太郎」がアプリケーションを操作する
- **Then** 「花子」に割り当てられたタスクは画面に表示されない

**シナリオ:** 未認証ユーザーはデータにアクセスできない
- **Given** ユーザーはログインしていない
- **When** タスク一覧画面のURLに直接アクセスしようとする
- **Then** ログイン画面にリダイレクトされる

## 同期・オフライン対応

### ACC-SYNC-001: オフライン時の操作 (UC-SYNC-001)

**シナリオ:** オフライン中に作成したタスクがオンライン復帰時に同期される
- **Given** ユーザーはオフライン状態である
- **When** ユーザーが新しいタスクを作成する
- **Then** タスク一覧に、そのタスクが「同期中」などのインジケータ付きで表示される

**シナリオ:** オフラインからオンラインへの復帰
- **Given** オフライン中に作成された未同期のタスクが存在する
- **When** デバイスがオンライン状態に復帰する
- **Then** 未同期タスクの「同期中」インジケータが自動的に消える
- **And** 他のデバイスからでもそのタスクが閲覧可能になる

## パフォーマンス (非機能要件)

### ACC-PERF-001: 応答速度
- **Given** 1つの家族に1000件のタスクと1000件の証拠データが存在する
- **When** ユーザーがタスク一覧画面を開く
- **Then** 画面は1秒以内に表示が完了する

- **Given** ユーザーがログインしている
- **When** アプリ内の任意の画面に遷移する
- **Then** 画面遷移は500ミリ秒以内に完了する
